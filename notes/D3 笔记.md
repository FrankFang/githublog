
# selection 是如何工作的？

译自 [How Selections Work](http://bost.ocks.org/mike/selection/)

本文除了说明如何使用 selection，还会解释 selection 是如何工作的。虽然要费些唇舌，但是我们能借此拨开 D3 的迷雾，更好地掌握数据驱动文档的理念。

## 约定

D3 是一个可视化库。本文也会配以大量的图例。在下文的图例中，左半部分展示 selection 的结构，右边展示对应的数据。

<svg width="740" height="120" style="margin:1em -10px;">
  <g transform="translate(9.5,9.5)">
	<rect fill="#eee" stroke="#ccc" stroke-dasharray="2,2" width="355" height="100"></rect>
	<rect fill="#eee" stroke="#ccc" stroke-dasharray="2,2" x="365" width="355" height="100"></rect>
	<rect fill="#a1d99b" fill-opacity=".8" stroke="#71a76c" stroke-dasharray="2,2" y="10" x="300" width="120" height="80"></rect>
	<text x="178" text-anchor="middle" y="50" dy=".35em">selection 放在左边</text>
	<text x="360" text-anchor="middle" y="50" dy=".35em">交互放在中间</text>
	<text x="543" text-anchor="middle" y="50" dy=".35em">数据放在右边</text>
  </g>
</svg>

圆角矩形 <span style="display:inline-block;position:relative;width:75px;"><svg style="position:absolute;top:-17px;" class="node" width="75" height="22"><g transform="translate(1,1)" class="datum"><rect rx="6" ry="6" width="73" height="20"></rect><text x="35" y="10" dy=".35em" text-anchor="middle">比如这样</text></g></svg></span> 表示 JavaScript 对象，包括对象（`{foo: 16}`）、字符串（`"hello"`）、数组（`[1,2,3]`）和 DOM 元素。某些对象会用特殊的圆角矩形表示，如 
<span style="display:inline-block;position:relative;width:55px;"><svg style="position:absolute;top:-17px;" class="node" width="55" height="22"><g transform="translate(1,1)" class="selection"><rect rx="6" ry="6" width="53" height="20"></rect><text x="26" y="10" dy=".35em" text-anchor="middle">selection</text></g></svg></span>
<span style="display:inline-block;position:relative;width:55px;"><svg style="position:absolute;top:-17px;" class="node" width="55" height="22"><g transform="translate(1,1)" class="array"><rect rx="6" ry="6" width="53" height="20"></rect><text x="26" y="10" dy=".35em" text-anchor="middle">数组</text></g></svg></span>
和 
<span style="display:inline-block;position:relative;width:55px;"><svg style="position:absolute;top:-17px;" class="node" width="55" height="22"><g transform="translate(1,1)" class="element"><rect rx="6" ry="6" width="53" height="20"></rect><text x="26" y="10" dy=".35em" text-anchor="middle">element</text></g></svg></span>
。

对象的引用用直线（<span style="display:inline-block;position:relative;width:55px;"><svg style="position:absolute;top:-17px;" class="link" width="55" height="22"><line x1="1" x2="54" y1="11" y2="11"></line></svg></span>）表示。例如，

~~~
var array = [42];
~~~

表示为

<svg width="800" height="24" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-datum from-array" d="M42.04800033569336,12C71.02400016784668,12 71.02400016784668,12 100,12"></path></g><g class="node"><g class="array" transform="translate(0,12)"><rect ry="6" rx="6" y="-10" height="20" width="42.04800033569336"></rect><text dy=".35em" x="6">array</text></g><g class="datum" transform="translate(100,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">42</text></g></g></g></svg>

图例对应的代码一般就放在图例上方。

## Array 的子类

也许有人认为 selection 就是 Array。但实际并没这么简单。

首先，selection 其实是 Array 的子类。这个子类提供一些方法让我们来操作所选的元素，比如设置属性（attribute）和样式（style）。当然 selection 也继承了 Array 的方法。不过一般来说你不需要使用 Array 的方法，因为 D3 提供了更为便利的接口。一些方法还被重写了，比如 `selection.filter` 和 `selection.sort`。


## 元素分组（group）

另外，selection 不是元素的数组，而是数组的数组：一个 selection 包含多个分组，每个分组包含多个元素。比如 `d3.select` 的结果是一个数组，它的第一个元素是一个 group，这个 group 也是一个数组，里面包含所选的元素：

~~~
var selection = d3.select('body')
~~~

<svg width="800" height="24" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,12C82.0339584350586,12 82.0339584350586,12 100,12"></path><path class="to-element from-array" d="M147.0279541015625,12C173.51397705078125,12 173.51397705078125,12 200,12"></path></g><g class="node"><g class="selection" transform="translate(0,12)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,12)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="42.695953369140625"></rect><text dy=".35em" x="6">body</text></g></g></g></svg>

在 JavaScript 控制台查看，你会发现 `selection[0]` 就是这个分组，而 `selection[0][0]` 就是所选元素了。

同样， `d3.selectAll` 的结果是一个包含多个元素的分组。

~~~
var selection = d3.selectAll('h2')
~~~

<svg width="800" height="96" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,48C82.0339584350586,48 82.0339584350586,48 100,48"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path></g><g class="node"><g class="selection" transform="translate(0,48)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">h2</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">h2</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">h2</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">h2</text></g></g></g></svg>

d3.select 和 d3.selectAll 的结果都只含有一个 group。如果你想获取多个 group，你要使用 `selection.selectAll`。例如：

~~~
d3.selectAll('tr').selectAll('td')
~~~

<svg width="800" height="384" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,144)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link" style=""><path class="to-array from-selection" d="M64.06791687011719,48C82.0339584350586,48 82.0339584350586,48 100,48"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path></g><g class="node"><g class="selection" transform="translate(0,48)" style=""><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">tr</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">tr</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">tr</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">tr</text></g></g></g><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,48 100,48" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,144 100,144" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,240 100,240" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,336 100,336" style=""></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12" style=""></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36" style=""></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60" style=""></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84" style=""></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,108 200,108" style=""></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,132 200,132" style=""></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,156 200,156" style=""></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,180 200,180" style=""></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,204 200,204" style=""></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,228 200,228" style=""></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,252 200,252" style=""></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,276 200,276" style=""></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,300 200,300" style=""></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,324 200,324" style=""></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,348 200,348" style=""></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,372 200,372" style=""></path></g><g class="node"><g class="selection" transform="translate(0,192)" style=""><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="element" transform="translate(200,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,132)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,156)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,180)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,204)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,228)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,252)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,276)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,300)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,324)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,348)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,372)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="array" transform="translate(100,48)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,144)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,240)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,336)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g></g></g></svg>

在使用 selectAll 时，原来的 selection 里的每个元素在新的 selection 里面都会变成一个分组（group）；每个 group 包含该元素的子元素。因此，如果每个 `<td>` 包含一个 `<span>` 的话，再次调用 selectAll 会得到一个包含16 个 group 的 selection：

~~~
d3.selectAll("tr").selectAll("td").selectAll("span")
~~~

<svg width="800" height="384" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link" style=""><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,48 100,48"></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,144 100,144"></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,240 100,240"></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,336 100,336"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,108 200,108"></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,132 200,132"></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,156 200,156"></path><path class="to-element from-array" d="M147.0279541015625,144C173.51397705078125,144 173.51397705078125,180 200,180"></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,204 200,204"></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,228 200,228"></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,252 200,252"></path><path class="to-element from-array" d="M147.0279541015625,240C173.51397705078125,240 173.51397705078125,276 200,276"></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,300 200,300"></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,324 200,324"></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,348 200,348"></path><path class="to-element from-array" d="M147.0279541015625,336C173.51397705078125,336 173.51397705078125,372 200,372"></path></g><g class="node"><g class="selection" transform="translate(0,192)" style=""><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="array" transform="translate(100,144)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,132)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,156)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,180)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="array" transform="translate(100,240)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,204)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,228)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,252)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,276)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="array" transform="translate(100,336)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,300)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,324)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,348)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g><g class="element" transform="translate(200,372)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">td</text></g></g></g><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,12 100,12" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,36 100,36" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,60 100,60" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,84 100,84" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,108 100,108" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,132 100,132" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,156 100,156" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,180 100,180" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,204 100,204" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,228 100,228" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,252 100,252" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,276 100,276" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,300 100,300" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,324 100,324" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,348 100,348" style=""></path><path class="to-array from-selection" d="M64.06791687011719,192C82.0339584350586,192 82.0339584350586,372 100,372" style=""></path><path class="to-element from-array" d="M147.0279541015625,12C173.51397705078125,12 173.51397705078125,12 200,12" style=""></path><path class="to-element from-array" d="M147.0279541015625,36C173.51397705078125,36 173.51397705078125,36 200,36" style=""></path><path class="to-element from-array" d="M147.0279541015625,60C173.51397705078125,60 173.51397705078125,60 200,60" style=""></path><path class="to-element from-array" d="M147.0279541015625,84C173.51397705078125,84 173.51397705078125,84 200,84" style=""></path><path class="to-element from-array" d="M147.0279541015625,108C173.51397705078125,108 173.51397705078125,108 200,108" style=""></path><path class="to-element from-array" d="M147.0279541015625,132C173.51397705078125,132 173.51397705078125,132 200,132" style=""></path><path class="to-element from-array" d="M147.0279541015625,156C173.51397705078125,156 173.51397705078125,156 200,156" style=""></path><path class="to-element from-array" d="M147.0279541015625,180C173.51397705078125,180 173.51397705078125,180 200,180" style=""></path><path class="to-element from-array" d="M147.0279541015625,204C173.51397705078125,204 173.51397705078125,204 200,204" style=""></path><path class="to-element from-array" d="M147.0279541015625,228C173.51397705078125,228 173.51397705078125,228 200,228" style=""></path><path class="to-element from-array" d="M147.0279541015625,252C173.51397705078125,252 173.51397705078125,252 200,252" style=""></path><path class="to-element from-array" d="M147.0279541015625,276C173.51397705078125,276 173.51397705078125,276 200,276" style=""></path><path class="to-element from-array" d="M147.0279541015625,300C173.51397705078125,300 173.51397705078125,300 200,300" style=""></path><path class="to-element from-array" d="M147.0279541015625,324C173.51397705078125,324 173.51397705078125,324 200,324" style=""></path><path class="to-element from-array" d="M147.0279541015625,348C173.51397705078125,348 173.51397705078125,348 200,348" style=""></path><path class="to-element from-array" d="M147.0279541015625,372C173.51397705078125,372 173.51397705078125,372 200,372" style=""></path></g><g class="node"><g class="selection" transform="translate(0,192)" style=""><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="element" transform="translate(200,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,132)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,156)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,180)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,204)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,228)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,252)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,276)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,300)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,324)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,348)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="element" transform="translate(200,372)" style=""><rect ry="6" rx="6" y="-10" height="20" width="40.35597229003906"></rect><text dy=".35em" x="6">span</text></g><g class="array" transform="translate(100,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,132)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,156)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,180)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,204)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,228)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,252)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,276)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,300)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,324)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,348)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="array" transform="translate(100,372)" style=""><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g></g></g></svg>

每个 group 都有一个 *parentNode* 属性，指向 group 所包含元素的所共有的父元素（如果没有父元素，那么就是 `document`）。

大部分时候，你都不需要知道 selection 是分组的。因为在你调用 `selection.attr` 或 `selection.style` 的时候，D3 会自动地遍历 group 里的每个元素。

## 非分组的操作

只有 selectAll 对 group 有特殊操作，select 则保留现有的 group。这是因为使用 select 时，新的 selection 中都只有一个元素，所以 select 会将数据从父元素传递到子元素。而 selectAll 却不能这样做（所以我们需要做数据合并 data-join）

[`append`](https://github.com/mbostock/d3/blob/master/src/selection/append.js) 和 [`insert`](https://github.com/mbostock/d3/blob/master/src/selection/insert.js) 方法的实现都是基于 `select` 方法，所以他们也保留原有的 group 并传递数据给子元素。例如现在有一个包含 4 个 `<section>` 的页面：

~~~
d3.selectAll('section')
~~~

<svg width="800" height="96" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,48C82.0339584350586,48 82.0339584350586,48 100,48"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path></g><g class="node"><g class="selection" transform="translate(0,48)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="53.86793518066406"></rect><text dy=".35em" x="6">section</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="53.86793518066406"></rect><text dy=".35em" x="6">section</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="53.86793518066406"></rect><text dy=".35em" x="6">section</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="53.86793518066406"></rect><text dy=".35em" x="6">section</text></g></g></g></svg>

如果你向每个 `<section>` 添加一个 `<p>`，新的 selection 只含有一个 group。

~~~
d3.selectAll('section').append('p')
~~~

<svg width="800" height="96" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,48C82.0339584350586,48 82.0339584350586,48 100,48"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path></g><g class="node"><g class="selection" transform="translate(0,48)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">p</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">p</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">p</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">p</text></g></g></g></svg>

需要注意的是此时 parentNode 指向的还是 document，因为 select 保留了原有的 group。

## 空元素（Null Elements）

group 有时候会包含空元素，作为占位符。大部分操作都会忽略空元素，比如 `attr` 和 `style` 方法。

当 selection.select 无法查询到指定匹配的元素时，就会出现空元素。由于 select 方法必须保留 group，所以没有找到子元素的地方就用空（null）来代替了。例如，只有最后两个 `<section>` 包含 `<aside>`：

~~~
d3.selectAll('selection').select('aside')
~~~

<svg width="800" height="96" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,48C82.0339584350586,48 82.0339584350586,48 100,48"></path><path class="to-null from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,12 200,12"></path><path class="to-null from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,36 200,36"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,60 200,60"></path><path class="to-element from-array" d="M147.0279541015625,48C173.51397705078125,48 173.51397705078125,84 200,84"></path></g><g class="node"><g class="selection" transform="translate(0,48)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="null" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">null</text></g><g class="null" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">null</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="43.27195739746094"></rect><text dy=".35em" x="6">aside</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="43.27195739746094"></rect><text dy=".35em" x="6">aside</text></g></g></g></svg>

一般来说你可以忽略空元素，只要注意下 group 的结构和这些元素在 group 的 index 就可以了。

## 绑定数据

你也许会奇怪为什么数据不是 selection 的属性，而是元素的属性。在 D3 里面绑定数据到 selection 时，数据其实被存储到了 DOM 里，具体来说是放在每个元素的 `__data__` 属性里。如果元素没用这个属性，那就意味着它没有绑定数据。如此一来，数据是持久的，selection 只是暂时的。当你再次选中这些 DOM 时，数据也就拿到了。

数据通过下列几种方式绑定到元素：

* 通过 selection.data 被连接到 group。
* 通过 selection.datum 被直接绑定到特定的元素。
* 通过 append / insert / select 从父元素继承。

理论上来说我们不应该通过给 `__data__` 赋值来绑定数据，不过我们可以通过设置 `__data__` 来了解数据绑定的过程：

~~~
document.body.__data__ = 42
~~~

<svg width="800" height="24" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-datum from-element" d="M42.695953369140625,12C71.34797668457031,12 71.34797668457031,12 100,12"></path></g><g class="node"><g class="element" transform="translate(0,12)"><rect ry="6" rx="6" y="-10" height="20" width="42.695953369140625"></rect><text dy=".35em" x="6">body</text></g><g class="datum" transform="translate(100,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">42</text></g></g></g></svg>

符合 D3 书写习惯的写法是：

~~~
d3.select('body').datum(42)
~~~

<svg width="800" height="24" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,12C82.0339584350586,12 82.0339584350586,12 100,12"></path><path class="to-element from-array" d="M147.0279541015625,12C173.51397705078125,12 173.51397705078125,12 200,12"></path><path class="to-datum from-element" d="M242.69595336914062,12C271.3479766845703,12 271.3479766845703,12 300,12"></path></g><g class="node"><g class="selection" transform="translate(0,12)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,12)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="42.695953369140625"></rect><text dy=".35em" x="6">body</text></g><g class="datum" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">42</text></g></g></g></svg>

如果现在向 body 里 append 一个元素，那么这个元素自动继承 body 的数据：

~~~
d3.select('body').datum(42).append('h1')
~~~

<svg width="800" height="24" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M64.06791687011719,12C82.0339584350586,12 82.0339584350586,12 100,12"></path><path class="to-element from-array" d="M147.0279541015625,12C173.51397705078125,12 173.51397705078125,12 200,12"></path><path class="to-datum from-element" d="M232,12C266,12 266,12 300,12"></path></g><g class="node"><g class="selection" transform="translate(0,12)"><rect ry="6" rx="6" y="-10" height="20" width="64.06791687011719"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,12)"><rect ry="6" rx="6" y="-10" height="20" width="47.0279541015625"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">h1</text></g><g class="datum" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">42</text></g></g></g></svg>


三种数据绑定我们还剩最后一个方法没有了解：`selection.data`。不过在我们了解它之前，还有几个更重要的问题需要回答。

## 什么是数据？

D3 里的数据是任意数组。例如整数数组：

~~~
var numbers = [4,5,18,23,42]
~~~

也可以是对象的数组：

~~~
var letters = [
    {name: "A", frequency: .08167},
    {name: "B", frequency: .01492},
    {name: "C", frequency: .02780},
    {name: "D", frequency: .04253},
    {name: "E", frequency: .12702}
];
~~~

或者数组的数组：

~~~
var matrix = [
  [ 0,  1,  2,  3],
  [ 4,  5,  6,  7],
  [ 8,  9, 10, 11],
  [12, 13, 14, 15]
];
~~~

图示如下：

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="right" transform="translate(760,0)"><g class="link"><path class="to-datum from-array" d="M-45.386653900146484,60C-72.69332695007324,60 -72.69332695007324,12 -100,12"></path><path class="to-datum from-array" d="M-45.386653900146484,60C-72.69332695007324,60 -72.69332695007324,36 -100,36"></path><path class="to-datum from-array" d="M-45.386653900146484,60C-72.69332695007324,60 -72.69332695007324,60 -100,60"></path><path class="to-datum from-array" d="M-45.386653900146484,60C-72.69332695007324,60 -72.69332695007324,84 -100,84"></path><path class="to-datum from-array" d="M-45.386653900146484,60C-72.69332695007324,60 -72.69332695007324,108 -100,108"></path></g><g class="node"><g class="array" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-100,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">4</text></g><g class="datum" transform="translate(-100,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">5</text></g><g class="datum" transform="translate(-100,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">18</text></g><g class="datum" transform="translate(-100,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">23</text></g><g class="datum" transform="translate(-100,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">42</text></g></g></g></svg>

`selection.data` 可以一个字符串作为参数，也可以接受一个函数，用来动态地计算数据。这一点与 `selection.style` 和 `selection.attr` 等方法是类似的。

但是，与其他方法不同的是，`selection.data` 的数据与 group 对应，而不是与元素对应。一个数组对应一个 group，含有多个组的 selection 就有一个含多个数组的 data 与之绑定。

<svg width="800" height="384" style="margin: 1em 0px 1em -40px;"><g class="right" transform="translate(760,0)"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,48 -100,48"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,144 -100,144"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,240 -100,240"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,336 -100,336"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,12 -200,12"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,36 -200,36"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,60 -200,60"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,84 -200,84"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,108 -200,108"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,132 -200,132"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,156 -200,156"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,180 -200,180"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,204 -200,204"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,228 -200,228"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,252 -200,252"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,276 -200,276"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,300 -200,300"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,324 -200,324"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,348 -200,348"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,372 -200,372"></path></g><g class="node"><g class="data" transform="translate(0,192)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,48)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">0</text></g><g class="datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">1</text></g><g class="datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">2</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">3</text></g><g class="array" transform="translate(-100,144)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">4</text></g><g class="datum" transform="translate(-200,132)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">5</text></g><g class="datum" transform="translate(-200,156)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">6</text></g><g class="datum" transform="translate(-200,180)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">7</text></g><g class="array" transform="translate(-100,240)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,204)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">8</text></g><g class="datum" transform="translate(-200,228)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">9</text></g><g class="datum" transform="translate(-200,252)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">10</text></g><g class="datum" transform="translate(-200,276)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">11</text></g><g class="array" transform="translate(-100,336)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,300)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">12</text></g><g class="datum" transform="translate(-200,324)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">13</text></g><g class="datum" transform="translate(-200,348)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">14</text></g><g class="datum" transform="translate(-200,372)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">15</text></g></g></g></svg>

图中的蓝线表示 <span style="display:inline-block;position:relative;width:55px;"><svg style="position:absolute;top:-17px;" class="node" width="55" height="22"><g transform="translate(1,1)" class="data"><rect rx="6" ry="6" width="53" height="20"></rect><text x="26" y="10" dy=".35em" text-anchor="middle">data</text></g></svg></span> 是一个函数，它返回对应的数组。这个 data 函数接受两个参数，第一个是对应 group 的 parentNode（一般这个形参被命名为 `d`），另一个是 group 的索引（`i`），返回值是绑定到该 group 的数组。所以一般 data 都被定义为一个与 parentNode 相关的函数，通过结构化的 DOM 来构造结构化的 data。

对于只包含一个 group 的 selection，你可以只传递一个数组给 `selection.data`；只有在给多个 group 绑定数据时，你才需要一个 data 函数。

## 入门的关键

要把数据绑定到元素，首先我们必须知道数据与元素的一一对应关系。这是通过 key 的匹配做到的。一个 key 其实就是一个唯一标识符。比如 `name`。当数据的 key 与元素的 key 相同时，数据就会被绑定到这个元素。

最简单的 key 就是索引（index）了：第 n 个数据和第 n 个元素的 key 都是 `"n"`，n = 0,1,2,3... 如下图，一个整数数组绑定到几个 `<div>` 元素上，绿色的就是 key：

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">0</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">1</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">2</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">3</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">4</text></g></g></g><g class="right" transform="translate(760,0)"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108"></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12"></path><path class="to-key from-datum" d="M-232,36C-266,36 -266,36 -300,36"></path><path class="to-key from-datum" d="M-232,60C-266,60 -266,60 -300,60"></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84"></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108"></path></g><g class="node"><g class="data" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">4</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">0</text></g><g class="datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">5</text></g><g class="key" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">1</text></g><g class="datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">18</text></g><g class="key" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">2</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">23</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">3</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">42</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">4</text></g></g></g></svg>

~~~
d3.selectAll('div').data(numbers)
~~~

得到的 selection ：

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-datum from-element" d="M232,12C266,12 266,12 300,12"></path><path class="to-datum from-element" d="M232,36C266,36 266,36 300,36"></path><path class="to-datum from-element" d="M232,60C266,60 266,60 300,60"></path><path class="to-datum from-element" d="M232,84C266,84 266,84 300,84"></path><path class="to-datum from-element" d="M232,108C266,108 266,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">div</text></g><g class="datum" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">4</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">div</text></g><g class="datum" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">5</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">div</text></g><g class="datum" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">18</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">div</text></g><g class="datum" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">23</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">div</text></g><g class="datum" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">42</text></g></g></g></svg>

如果你的数据和元素有同样的排序，用 index 当作 key 确实是很方便。但是，如果顺序是不一样的，这种办法就行不通。遇到这种情况，你可以给 `selection.data` 传递一个 key 函数，作为第二个参数。 key 函数根据元素或数据返回不同的 key 值。例如，你想把 name 的值作为 key 值：

~~~
var letters = [
  {name: "A", frequency: .08167},
  {name: "B", frequency: .01492},
  {name: "C", frequency: .02780},
  {name: "D", frequency: .04253},
  {name: "E", frequency: .12702}
];

function getKey(d) {
  return d.name;
}

d3.selectAll("div").data(letters, getKey);
~~~

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-24 88,-24"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-24 88,-24"></path><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">E</text></g></g></g><g class="right" transform="translate(760,0)"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60"></path><path class="to-code to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12"></path><path class="to-code to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36"></path><path class="to-code to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60"></path><path class="to-code to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84"></path><path class="to-code to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108"></path><path class="to-key from-code from-datum" d="M-300.01434326171875,12C-300.0071716308594,12 -300.0071716308594,12 -300,12"></path><path class="to-key from-code from-datum" d="M-300.01434326171875,36C-300.0071716308594,36 -300.0071716308594,36 -300,36"></path><path class="to-key from-code from-datum" d="M-300.01434326171875,60C-300.0071716308594,60 -300.0071716308594,60 -300,60"></path><path class="to-key from-code from-datum" d="M-300.01434326171875,84C-300.0071716308594,84 -300.0071716308594,84 -300,84"></path><path class="to-key from-code from-datum" d="M-300.01434326171875,108C-300.0071716308594,108 -300.0071716308594,108 -300,108"></path></g><g class="node"><g class="data" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="code datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="100.01434326171875" x="-100.01434326171875"></rect><text dy=".35em" x="-94.01434326171875">{name: "A"}</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="code datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="100.01434326171875" x="-100.01434326171875"></rect><text dy=".35em" x="-94.01434326171875">{name: "B"}</text></g><g class="key" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="code datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="100.01434326171875" x="-100.01434326171875"></rect><text dy=".35em" x="-94.01434326171875">{name: "C"}</text></g><g class="key" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="code datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="100.01434326171875" x="-100.01434326171875"></rect><text dy=".35em" x="-94.01434326171875">{name: "D"}</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="code datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="100.01434326171875" x="-100.01434326171875"></rect><text dy=".35em" x="-94.01434326171875">{name: "E"}</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g></g></g></svg>

注：在这个例子里 key 函数被调用了 10 次，在 5 个元素上调用了 5 次，在 5 个对象上调用了 5 次。在元素上调用是为了计算原先的 key，在对象上调用是为了计算新的 key。

不同的 group 的数据绑定是独立的，所以 key 只要在一个 group 里是为唯一的就行了，不需要在整个 selection 里都是唯一的。

<svg width="800" height="384" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,192C84.92662239074707,192 84.92662239074707,48 100,48"></path><path class="to-array from-selection" d="M69.85324478149414,192C84.92662239074707,192 84.92662239074707,144 100,144"></path><path class="to-array from-selection" d="M69.85324478149414,192C84.92662239074707,192 84.92662239074707,240 100,240"></path><path class="to-array from-selection" d="M69.85324478149414,192C84.92662239074707,192 84.92662239074707,336 100,336"></path><path class="to-element from-array" d="M150.91994857788086,48C175.45997428894043,48 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,48C175.45997428894043,48 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,48C175.45997428894043,48 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,48C175.45997428894043,48 175.45997428894043,84 200,84"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-element from-array" d="M150.91994857788086,144C175.45997428894043,144 175.45997428894043,108 200,108"></path><path class="to-element from-array" d="M150.91994857788086,144C175.45997428894043,144 175.45997428894043,132 200,132"></path><path class="to-element from-array" d="M150.91994857788086,144C175.45997428894043,144 175.45997428894043,156 200,156"></path><path class="to-element from-array" d="M150.91994857788086,144C175.45997428894043,144 175.45997428894043,180 200,180"></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path><path class="to-key from-element" d="M265.82659912109375,132C282.9132995605469,132 282.9132995605469,132 300,132"></path><path class="to-key from-element" d="M265.82659912109375,156C282.9132995605469,156 282.9132995605469,156 300,156"></path><path class="to-key from-element" d="M265.82659912109375,180C282.9132995605469,180 282.9132995605469,180 300,180"></path><path class="to-element from-array" d="M150.91994857788086,240C175.45997428894043,240 175.45997428894043,204 200,204"></path><path class="to-element from-array" d="M150.91994857788086,240C175.45997428894043,240 175.45997428894043,228 200,228"></path><path class="to-element from-array" d="M150.91994857788086,240C175.45997428894043,240 175.45997428894043,252 200,252"></path><path class="to-element from-array" d="M150.91994857788086,240C175.45997428894043,240 175.45997428894043,276 200,276"></path><path class="to-key from-element" d="M265.82659912109375,204C282.9132995605469,204 282.9132995605469,204 300,204"></path><path class="to-key from-element" d="M265.82659912109375,228C282.9132995605469,228 282.9132995605469,228 300,228"></path><path class="to-key from-element" d="M265.82659912109375,252C282.9132995605469,252 282.9132995605469,252 300,252"></path><path class="to-key from-element" d="M265.82659912109375,276C282.9132995605469,276 282.9132995605469,276 300,276"></path><path class="to-element from-array" d="M150.91994857788086,336C175.45997428894043,336 175.45997428894043,300 200,300"></path><path class="to-element from-array" d="M150.91994857788086,336C175.45997428894043,336 175.45997428894043,324 200,324"></path><path class="to-element from-array" d="M150.91994857788086,336C175.45997428894043,336 175.45997428894043,348 200,348"></path><path class="to-element from-array" d="M150.91994857788086,336C175.45997428894043,336 175.45997428894043,372 200,372"></path><path class="to-key from-element" d="M265.82659912109375,300C282.9132995605469,300 282.9132995605469,300 300,300"></path><path class="to-key from-element" d="M265.82659912109375,324C282.9132995605469,324 282.9132995605469,324 300,324"></path><path class="to-key from-element" d="M265.82659912109375,348C282.9132995605469,348 282.9132995605469,348 300,348"></path><path class="to-key from-element" d="M265.82659912109375,372C282.9132995605469,372 282.9132995605469,372 300,372"></path></g><g class="node"><g class="selection" transform="translate(0,192)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,48)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-72 88,-72"></path><text dy=".35em" x="6">A</text></g><g class="array" transform="translate(100,144)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,132)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,132)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,156)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,156)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,24 88,24"></path><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,180)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,180)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-24 88,-24"></path><text dy=".35em" x="6">C</text></g><g class="array" transform="translate(100,240)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,204)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,204)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,228)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,228)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,252)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,252)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,0 88,0"></path><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,276)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,276)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-48 88,-48"></path><text dy=".35em" x="6">C</text></g><g class="array" transform="translate(100,336)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,300)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,300)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,324)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,324)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,348)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,348)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-48 88,-48"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,372)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,372)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-48 88,-48"></path><text dy=".35em" x="6">B</text></g></g></g><g class="right" transform="translate(760,0)"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,48 -100,48"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,144 -100,144"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,240 -100,240"></path><path class="to-array from-data" d="M-43.866641998291016,192C-71.93332099914551,192 -71.93332099914551,336 -100,336"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,12 -200,12"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,36 -200,36"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,60 -200,60"></path><path class="to-datum from-array" d="M-145.38665390014648,48C-172.69332695007324,48 -172.69332695007324,84 -200,84"></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12"></path><path class="to-key from-datum" d="M-232,36C-266,36 -266,36 -300,36"></path><path class="to-key from-datum" d="M-232,60C-266,60 -266,60 -300,60"></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,108 -200,108"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,132 -200,132"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,156 -200,156"></path><path class="to-datum from-array" d="M-145.38665390014648,144C-172.69332695007324,144 -172.69332695007324,180 -200,180"></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108"></path><path class="to-key from-datum" d="M-232,132C-266,132 -266,132 -300,132"></path><path class="to-key from-datum" d="M-232,156C-266,156 -266,156 -300,156"></path><path class="to-key from-datum" d="M-232,180C-266,180 -266,180 -300,180"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,204 -200,204"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,228 -200,228"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,252 -200,252"></path><path class="to-datum from-array" d="M-145.38665390014648,240C-172.69332695007324,240 -172.69332695007324,276 -200,276"></path><path class="to-key from-datum" d="M-232,204C-266,204 -266,204 -300,204"></path><path class="to-key from-datum" d="M-232,228C-266,228 -266,228 -300,228"></path><path class="to-key from-datum" d="M-232,252C-266,252 -266,252 -300,252"></path><path class="to-key from-datum" d="M-232,276C-266,276 -266,276 -300,276"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,300 -200,300"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,324 -200,324"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,348 -200,348"></path><path class="to-datum from-array" d="M-145.38665390014648,336C-172.69332695007324,336 -172.69332695007324,372 -200,372"></path><path class="to-key from-datum" d="M-232,300C-266,300 -266,300 -300,300"></path><path class="to-key from-datum" d="M-232,324C-266,324 -266,324 -300,324"></path><path class="to-key from-datum" d="M-232,348C-266,348 -266,348 -300,348"></path><path class="to-key from-datum" d="M-232,372C-266,372 -266,372 -300,372"></path></g><g class="node"><g class="data" transform="translate(0,192)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,48)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="key" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="key" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="array" transform="translate(-100,144)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,132)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="key" transform="translate(-300,132)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="datum" transform="translate(-200,156)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="key" transform="translate(-300,156)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="datum" transform="translate(-200,180)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="key" transform="translate(-300,180)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="array" transform="translate(-100,240)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,204)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,204)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,228)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="key" transform="translate(-300,228)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="datum" transform="translate(-200,252)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="key" transform="translate(-300,252)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="datum" transform="translate(-200,276)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="key" transform="translate(-300,276)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="array" transform="translate(-100,336)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,300)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,300)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,324)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="key" transform="translate(-300,324)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">B</text></g><g class="datum" transform="translate(-200,348)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="key" transform="translate(-300,348)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">C</text></g><g class="datum" transform="translate(-200,372)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g><g class="key" transform="translate(-300,372)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">D</text></g></g></g></svg>

上面的例子都假设数据和元素是一一对应的，但如果不是一一对应的会怎么样呢？

## enter, update 和 exit

绑定数据的时候，有下面三种情况：

* Update - 对于给定的数据匹配，已经有与之匹配的元素，我们只需要更新它们。
* Enter - 对于给定的数据匹配，没有元素与之匹配，我们需要创建新的元素。
* Exit - 有些已经绑定了数据的元素，然后新的数据里却没有与之对应的，我们可以删除这些元素。

`selection.data` , `selection.enter` 和 `selection.exit` 返回三种不同的 selection。假设现在有一个柱形图，它有 5 个柱子，key 分别是 A B C D E，现在我们要把它们变为 5 个元音字母 Y E A O I。   



<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-72 88,-72"></path><text dy=".35em" x="6">E</text></g></g></g><g class="right" transform="translate(760,0)"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108"></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12"></path><path class="to-key from-datum" d="M-232,36C-266,36 -266,36 -300,36"></path><path class="to-key from-datum" d="M-232,60C-266,60 -266,60 -300,60"></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84"></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108"></path></g><g class="node"><g class="data" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="key" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g></g></g></svg>

A 和 E 已经出现在图中了，这两个需要被更新的柱子就会被 selection.update 选中，其顺序与新数据的顺序相同。

~~~
var div = d3.selectAll("div").data(vowels, name);

div.update()
~~~

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-datum from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-datum from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="null" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">E</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">A</text></g><g class="null" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g><g class="null" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g></g></g><g class="left" transform="translate(40,0)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36" style=""></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60" style=""></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84" style=""></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">A</text></g><g class="key" transform="translate(300,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">B</text></g><g class="key" transform="translate(300,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">C</text></g><g class="key" transform="translate(300,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">D</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-72 88,-72"></path><text dy=".35em" x="6">E</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="element" transform="translate(200,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="element" transform="translate(200,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="element" transform="translate(200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g></g></g><g class="right" transform="translate(760,0)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108" style=""></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12" style=""></path><path class="to-key from-datum joined" d="M-232,36C-266,36 -266,36 -300,36"></path><path class="to-key from-datum joined" d="M-232,60C-266,60 -266,60 -300,60"></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84" style=""></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108" style=""></path></g><g class="node"><g class="data" transform="translate(0,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="key" transform="translate(-300,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="key joined" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="key joined" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="key" transform="translate(-300,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g><g class="datum" transform="translate(-200,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="datum joined" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="datum joined" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="datum" transform="translate(-200,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g></g></g></svg>

另外的三个辅音字母（B C D）没有对应的数据，会被 selection.exit 选中。exit 选中的元素保留旧的顺序。

~~~
div.exit()
~~~

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-datum from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-datum from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-datum from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="null" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">D</text></g><g class="null" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g></g></g><g class="left" transform="translate(40,0)" style="stroke-opacity: 0; fill-opacity: 0; display: none;"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-72 88,-72"></path><text dy=".35em" x="6">E</text></g></g></g><g class="right" transform="translate(760,0)" style="stroke-opacity: 0; fill-opacity: 0; display: none;"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84"></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108"></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12"></path><path class="to-key from-datum" d="M-232,36C-266,36 -266,36 -300,36"></path><path class="to-key from-datum" d="M-232,60C-266,60 -266,60 -300,60"></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84"></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108"></path></g><g class="node"><g class="data" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)"><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="datum" transform="translate(-200,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="key" transform="translate(-300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="datum" transform="translate(-200,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key" transform="translate(-300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g></g></g></svg>

最后，三个新的元音（Y O I）之前没有展示过，没有对应的元素，会被 selection.enter 选中：

~~~
div.enter()
~~~

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84" style=""></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108" style=""></path><path class="to-key from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12" style=""></path><path class="to-key from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36" style=""></path><path class="to-key from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60" style=""></path><path class="to-key from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84" style=""></path><path class="to-key from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108" style=""></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,48 88,48"></path><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">B</text></g><g class="element" transform="translate(200,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">C</text></g><g class="element" transform="translate(200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">D</text></g><g class="element" transform="translate(200,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="key" transform="translate(300,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><path class="join" d="M32,0C60,0 60,-72 88,-72"></path><text dy=".35em" x="6">E</text></g></g></g><g class="right" transform="translate(760,0)" style="stroke-opacity: 1; fill-opacity: 1; display: none;"><g class="link"><path class="to-array from-data" d="M-43.866641998291016,60C-71.93332099914551,60 -71.93332099914551,60 -100,60" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,12 -200,12" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,36 -200,36" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,60 -200,60" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,84 -200,84" style=""></path><path class="to-datum from-array" d="M-145.38665390014648,60C-172.69332695007324,60 -172.69332695007324,108 -200,108" style=""></path><path class="to-key from-datum" d="M-232,12C-266,12 -266,12 -300,12" style=""></path><path class="to-key from-datum joined" d="M-232,36C-266,36 -266,36 -300,36" style=""></path><path class="to-key from-datum joined" d="M-232,60C-266,60 -266,60 -300,60" style=""></path><path class="to-key from-datum" d="M-232,84C-266,84 -266,84 -300,84" style=""></path><path class="to-key from-datum" d="M-232,108C-266,108 -266,108 -300,108" style=""></path></g><g class="node"><g class="data" transform="translate(0,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="43.866641998291016" x="-43.866641998291016"></rect><text dy=".35em" x="-37.866641998291016">data</text></g><g class="array" transform="translate(-100,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="45.386653900146484" x="-45.386653900146484"></rect><text dy=".35em" x="-39.386653900146484">array</text></g><g class="datum" transform="translate(-200,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="key" transform="translate(-300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">Y</text></g><g class="datum joined" transform="translate(-200,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="key joined" transform="translate(-300,36)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">E</text></g><g class="datum joined" transform="translate(-200,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="key joined" transform="translate(-300,60)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">A</text></g><g class="datum" transform="translate(-200,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="key" transform="translate(-300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">O</text></g><g class="datum" transform="translate(-200,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g><g class="key" transform="translate(-300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32" x="-32"></rect><text dy=".35em" x="-26">I</text></g></g></g><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-null from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-datum from-element" d="M291.50657653808594,12C295.75328826904297,12 295.75328826904297,12 300,12" style=""></path><path class="to-datum from-element" d="M291.50657653808594,84C295.75328826904297,84 295.75328826904297,84 300,84" style=""></path><path class="to-datum from-element" d="M291.50657653808594,108C295.75328826904297,108 295.75328826904297,108 300,108" style=""></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="91.50657653808594"></rect><text dy=".35em" x="6">placeholder</text></g><g class="datum" transform="translate(300,12)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">Y</text></g><g class="null" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g><g class="null" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="33.57330131530762"></rect><text dy=".35em" x="6">null</text></g><g class="element" transform="translate(200,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="91.50657653808594"></rect><text dy=".35em" x="6">placeholder</text></g><g class="datum" transform="translate(300,84)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">O</text></g><g class="element" transform="translate(200,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="91.50657653808594"></rect><text dy=".35em" x="6">placeholder</text></g><g class="datum" transform="translate(300,108)" style=""><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">I</text></g></g></g></svg>

update 和 exit 选中的都是常规的 selection，但是 enter 选中的比较特别，因为它表示的元素**并不存在**，enter 的 selection 包含的其实是占位符（placeholder），其实质是一个含有 __data__ 属性的对象。所以 [`enter.select` ](https://github.com/mbostock/d3/blob/master/src/selection/enter-select.js) 方法经过了特殊的设计，使得元素被插入到 group 的 parentNode，以取代这些占位符。

这就是为什么我们常常要在绑定数据之前调用 selection.selectAll：构造出多个 group，于是我们就有了多个 parentNode，最终我们就有了还多占位符。

## 合并更新

一般的更新数据的办法就是添加新的元素（enter），移除不要的元素（exit），更新旧的数据（update）。而且添加和更新操作一般都是很类似的。

为了减少重复的代码，enter.append 给我们提供了一个便利：它将 update 选中的元素中的空元素用 enter 中新生产的元素来代替。所以在调用 enter.append 之后，update 中就既有 enter 中的元素又有 update 原先包含的元素。也就是说 update 中包含了所有展示在图中的元素：

<svg width="800" height="120" style="margin: 1em 0px 1em -40px;"><g class="left" transform="translate(40,0)"><g class="link"><path class="to-array from-selection" d="M69.85324478149414,60C84.92662239074707,60 84.92662239074707,60 100,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,12 200,12"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,36 200,36"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,60 200,60"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,84 200,84"></path><path class="to-element from-array" d="M150.91994857788086,60C175.45997428894043,60 175.45997428894043,108 200,108"></path><path class="to-datum from-element" d="M265.82659912109375,12C282.9132995605469,12 282.9132995605469,12 300,12"></path><path class="to-datum from-element" d="M265.82659912109375,36C282.9132995605469,36 282.9132995605469,36 300,36"></path><path class="to-datum from-element" d="M265.82659912109375,60C282.9132995605469,60 282.9132995605469,60 300,60"></path><path class="to-datum from-element" d="M265.82659912109375,84C282.9132995605469,84 282.9132995605469,84 300,84"></path><path class="to-datum from-element" d="M265.82659912109375,108C282.9132995605469,108 282.9132995605469,108 300,108"></path></g><g class="node"><g class="selection" transform="translate(0,60)"><rect ry="6" rx="6" y="-10" height="20" width="69.85324478149414"></rect><text dy=".35em" x="6">selection</text></g><g class="array" transform="translate(100,60)"><rect ry="6" rx="6" y="-10" height="20" width="50.91994857788086"></rect><text dy=".35em" x="6">group</text></g><g class="element" transform="translate(200,12)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,12)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">Y</text></g><g class="element" transform="translate(200,36)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,36)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">E</text></g><g class="element" transform="translate(200,60)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,60)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">A</text></g><g class="element" transform="translate(200,84)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,84)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">O</text></g><g class="element" transform="translate(200,108)"><rect ry="6" rx="6" y="-10" height="20" width="65.82659912109375"></rect><text dy=".35em" x="6">element</text></g><g class="datum" transform="translate(300,108)"><rect ry="6" rx="6" y="-10" height="20" width="32"></rect><text dy=".35em" x="6">I</text></g></g></g></svg>

数据更新完成后，selection 就再一次与当前文档保持一致了！ 


